language: python

env:
  COLLECTION_PATH=ansible_collections/mattclay/vmware_demo_collection

branches:
  only:
    - master

build:
  ci:
    - pip install git+https://github.com/ansible/ansible.git@ef94e3c72a9afb96ba06a66edc0371e35fb3be56 --disable-pip-version-check
    - mkdir -p "/tmp/$COLLECTION_PATH"
    - cp -aT "$SHIPPABLE_BUILD_DIR" "/tmp/$COLLECTION_PATH"
    - cd "/tmp/$COLLECTION_PATH"
    - ansible-test sanity --docker -v --color --junit
    - ansible-test units --docker -v --color
    - ansible-test integration --docker -v --color --retry-on-error --python 2.7
    - ansible-test integration --docker -v --color --retry-on-error --python 3.7
  always:
    - cp -aT "/tmp/$COLLECTION_PATH/tests/output/junit/" shippable/testresults/
